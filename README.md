# ID4WithClientsOpenIDConnect

## Important Notices:
!!! THIS REPO IS JUST STARTING AND FOR NOW SHOULD BE CONSIDERED WORK IN PROGRESS!!!
I will remove this notice when the code is complete. 

!!! THIS REPO IS DEPENDENT on other github repositories for much of the source code:
https://github.com/IdentityServer/IdentityServer4 - IdentityServer4 Authentication ASP.Net Core 2 WebApi.
https://github.com/IdentityServer/IdentityServer4.Quickstart.UI - ASP.Net Core 2 MVC UI for "Login" and "Claims Consent"
https://github.com/jmurphzyo/Angular2OidcClient - ASP.Net Core 2 Angular.io UI Client
https://github.not/WebApiResource - ASP.Net Core 2 WebApi Service that will be called by both ASP.Net Core 2 MVC UI and ASP.Net WebForms UI.

## Purpose of this repo:
My code contribution is as follows (please see "Release Notes" for more detail):
1. Create a single Authentication Server application that will host both the Authentication WebApi and the Login, Consent, Forgot Password, and Revoke Access UI. It will be built by combining the https://github.com/IdentityServer/IdentityServer4 and https://github.com/IdentityServer/IdentityServer4.Quickstart.UI projects. Besides combining these projects, I will remove some Authentication Schemes that are not necessary for this project. 
2. Create a "WebForms project" from scratch that will connect to the IdentityServer4 UI and Authorization WebAPI via OWIN Middleware. 
3. Create an Angular UI application sharing the same Authentication Server. This UI has an with an iFrame that WebForms UI will be hosted in, which will allow the migration of an existing WebForms application to Angular over time. It will be built by extending the https://github.com/jmurphzyo/Angular2OidcClient project.
4. Create ASP.Net Core 2 WebApi Service that will be called by both ASP.Net Core 2 MVC UI and ASP.Net WebForms UI, that will demononstrate how it can examine and validate an access token and alternatively request token validation from the Authentication Server. It will be built by extending the https://github.not/WebApiResource project.
5. Create a Xamarin UI Application sharing the same Authentication Server.
6. Demonstrate Single Sign On (SSO) for all clients with Refresh Token and Token Revocation features.

This demo will allow you to see project differences, via repo history, between a WebForms Application with no Authentication, and one with Authentication provided by Identity Server 4. It will also show you how to modify the default Identity Server 4 application to limit the Authorization FLows so only those flows that are suitable for WebForm, ASP.Net Core, and Angular Clients to  connect in a secure fashion.

The theory is, if you already know how to remove your existing Membership Provider from a WebForms app (ie., no Authentication), then by examining the before and after project differences, you should be able to see how to replace an Authorization Membership Provider with ASP.Net Identity 4 and Identity Server 4.

## To start:
... the IdentityServer4 Authentication WebAPI and MVC UI for "Login" and "Claims Consent":

open a PowerShell prompt and build the solution:
```cmd
cd \YourLocalFolder\IdentityServer4
build.ps1
cd \YourLocalFolder\IdentityServer4\src\Host
```
Make sure program.cs is set to UseUrls:
```csharp
  var host = new WebHostBuilder()
          .UseKestrel()
          .UseUrls("http://localhost:5000")
          .etc
```
```cmd
dotnet run
  Hosting environment: Production
  Content root path: C:\Github\IdentityServer4\src\Host
  Now listening on: http://localhost:5000
  Application started. Press Ctrl+C to shut down.
```

## To Login:
http://localhost:5000/account/login

## Release Notes:
0.0.1 - Create a single Authentication Server application that will host both the Authentication WebApi and the Login, Consent, Forgot Password, and Revoke Access UI.
0.0.2 - Create ASP.Net Core 2 WebApi Service that validates an Access Token generated by the Authentication Server.
0.0.3 - Create Angular.io UI Client that calls the Create ASP.Net Core 2 WebApi Service.
0.0.4 - Create a WebForms UI Client that uses NO Authentication.
0.0.5 - Add Authentication to the WebForms UI Client using the same Auhentication Server as Angular.io.
0.0.6 - Create a Xamarin UI Client that uses the same Authentication WebApi.
0.0.99 - Eliminate unnecessary Authentication Code Flows from the Authorization Server code.


## Comments:

Once you realize that Identity Server 4 can be implemented as one or more applications, you may decide to split "Identity Server 4" into the 3 individual applications and host them on separate servers. For the purpose of this demo, the 3 applications that are intended to be deployed as one Authentication Server are: 
- ASP.Net Core MVC Login UI
- ASP.Net Core WebApi Authorization Services
- ASP.Net Core WebApi Token Services
